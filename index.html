<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ğŸ 2026æ˜¥èŠ‚ Â· çƒŸèŠ±è¿æ–°å¹´ ğŸ†</title>
    <style>
        /* ----- åŸæœ‰æ ·å¼ä¿æŒä¸å˜ ----- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(circle at 30% 20%, #ac2f2f, #6f1111);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M20 20 Q30 10 40 20 T60 20 T80 20" stroke="%23ffcc66" fill="none" stroke-width="1.5"/><circle cx="70" cy="70" r="3" fill="%23ffaa33"/><circle cx="15" cy="85" r="4" fill="%23ffaa33"/><circle cx="88" cy="18" r="2" fill="%23ffaa33"/></svg>');
            background-repeat: repeat;
            pointer-events: none;
            z-index: 0;
        }

        .card {
            position: relative;
            z-index: 10;
            max-width: 780px;
            width: 100%;
            background: #fffef7;
            background-image: linear-gradient(145deg, #fffdf0 0%, #fff5e6 100%);
            border-radius: 48px 48px 48px 48px;
            box-shadow: 0 30px 50px rgba(80, 0, 0, 0.6), 0 0 0 2px #e4bf7e inset, 0 0 0 5px #b54708 inset;
            padding: 2.5rem 2rem;
            text-align: center;
            transition: opacity 1.2s ease-in-out;
            border: 6px solid #cf7f3a;
            opacity: 1;
        }

        .card.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .card::after {
            content: 'ğŸ‰ ç¦ ğŸ‰';
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-size: 2.2rem;
            opacity: 0.1;
            color: #b33e3e;
            transform: rotate(-5deg);
            pointer-events: none;
        }

        .title {
            color: #972020;
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            letter-spacing: 6px;
            text-shadow: 2px 2px 0 #f9d77e, 4px 4px 0 rgba(180, 60, 20, 0.3);
            margin-bottom: 6px;
        }

        .sub-title {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            color: #b14b2c;
            background: linear-gradient(90deg, #f0cf96, #f7e2b5);
            display: inline-block;
            padding: 0.4rem 2rem;
            border-radius: 60px;
            margin: 10px 0 8px;
            font-weight: 600;
            box-shadow: 0 4px 8px #b2582e33;
            border: 1px solid #ffd57a;
        }

        .gregorian-date {
            font-size: 1.3rem;
            color: #773d1c;
            background: #fceedb;
            padding: 0.3rem 1.8rem;
            border-radius: 40px;
            display: inline-block;
            margin: 10px 0 20px;
            border: 1px dashed #c75e2b;
            font-weight: 500;
        }

        .countdown-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px 25px;
            margin: 35px 0 25px;
        }

        .time-block {
            background: #9f2d2d;
            background: linear-gradient(145deg, #b33b3b, #831e1e);
            border-radius: 32px;
            padding: 20px 12px 16px;
            min-width: 120px;
            flex: 1 1 0;
            box-shadow: 0 12px 0 #521212, 0 8px 15px #3d0f0f;
            border: 2px solid #fec169;
            transition: transform 0.1s ease;
        }

        .time-number {
            font-size: clamp(3.2rem, 8vw, 4.8rem);
            font-weight: 900;
            color: #ffdfa7;
            text-shadow: 0 3px 0 #aa4c1e, 0 6px 0 #542a0f;
            line-height: 1;
            margin-bottom: 6px;
            font-feature-settings: "tnum";
            letter-spacing: 4px;
        }

        .time-label {
            font-size: 1.3rem;
            color: #ffefc0;
            background: #ac3f2a;
            display: inline-block;
            padding: 5px 18px;
            border-radius: 40px;
            font-weight: 600;
            border: 1px solid #fcc56e;
            box-shadow: inset 0 -2px 0 #64200e;
        }

        .greeting-box {
            background: #ea9e48;
            background: linear-gradient(135deg, #f6b44a, #e8872b);
            border-radius: 50px;
            padding: 18px 18px;
            margin: 30px 0 10px;
            border: 3px solid #fde7b4;
            box-shadow: 0 6px 0 #a14415;
        }

        .greeting-text {
            font-size: 1.9rem;
            font-weight: 700;
            color: #2f0f00;
            text-shadow: 1px 1px 0 #ffcb7a;
            letter-spacing: 3px;
        }

        .sub-greeting {
            font-size: 1.2rem;
            color: #582b0b;
            margin-top: 6px;
        }

        .footer-note {
            margin-top: 30px;
            color: #b1572c;
            font-size: 1rem;
            border-top: 2px dotted #e5a45b;
            padding-top: 18px;
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .footer-note span {
            background: #ffefd2;
            padding: 6px 14px;
            border-radius: 30px;
            font-weight: 500;
            border: 1px solid #d48b47;
        }

        /* ----- çƒŸèŠ±è¦†ç›–å±‚ (é»‘è‰²èƒŒæ™¯) ----- */
        .fireworks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 100;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fireworks-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        /* ----- æ–‡æ¡ˆå®¹å™¨ (è´Ÿè´£æ‰¿è½½å¤šæ¡ç¥ç¦) ----- */
        .new-year-text {
            position: relative;
            width: 100%;
            height: 100%;
            z-index: 200;
            opacity: 1;
            pointer-events: none;
        }

        /* æ¯ä¸€æ¡æ–‡æ¡ˆçš„å…¬å…±æ ·å¼ (ç»å¯¹å®šä½å åŠ ) */
        .message-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            color: #FFD966;
            font-size: clamp(2rem, 10vw, 5rem);
            font-weight: 900;
            text-shadow: 0 0 20px #ffaa33, 0 0 40px #ff5500;
            font-family: 'KaiTi', 'æ¥·ä½“', 'åæ–‡æ¥·ä½“', serif;
            letter-spacing: 6px;
            transform: scale(0.9);
            animation: glowPulse 2s infinite alternate;
            pointer-events: none;
        }

        /* æœ€åä¸€æ¡æ–‡æ¡ˆå†…éƒ¨çš„å›¾ç‰‡æ ·å¼ */
        .last-item img {
            width: 1.5em;
            height: 1.5em;
            margin-left: 0.3em;
            vertical-align: middle;
            display: inline-block;
            filter: drop-shadow(0 0 5px #ffaa33);
        }

        .message-item.active {
            opacity: 1;
        }

        @keyframes glowPulse {
            from { text-shadow: 0 0 20px #ff9900, 0 0 40px #ff3300; }
            to { text-shadow: 0 0 30px #ffcc66, 0 0 70px #ff6633; }
        }

        .sound-tip {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            color: rgba(255,255,200,0.8);
            background: rgba(0,0,0,0.6);
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 1.2rem;
            border: 1px solid #ffb347;
            backdrop-filter: blur(4px);
            pointer-events: none;
            transition: opacity 0.5s;
            opacity: 0;
        }

        .sound-tip.show {
            opacity: 1;
        }

        .mono {
            font-family: 'Courier New', monospace;
        }

        /* ----- æ–°å¢å¯†ç éªŒè¯å±‚æ ·å¼ ----- */
        .password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.3s ease;
        }

        .password-overlay.hidden {
            display: none;
        }

        .password-box {
            background: #fff;
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .password-box h2 {
            margin-bottom: 1.5rem;
            color: #b33b3b;
            font-size: 1.8rem;
        }

        .password-box input {
            width: 100%;
            padding: 0.8rem;
            font-size: 1.2rem;
            border: 2px solid #f0cf96;
            border-radius: 10px;
            margin-bottom: 1rem;
            text-align: center;
            letter-spacing: 2px;
            outline: none;
        }

        .password-box input:focus {
            border-color: #b33b3b;
        }

        .password-box button {
            background: #b33b3b;
            color: white;
            border: none;
            padding: 0.8rem 2rem;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.2s;
            border: 1px solid #fec169;
        }

        .password-box button:hover {
            background: #8f2a2a;
        }

        .error-message {
            color: red;
            margin-top: 1rem;
            min-height: 1.5rem;
        }
    </style>
</head>
<body>
    <!-- å¯†ç éªŒè¯é®ç½© -->
    <div id="passwordOverlay" class="password-overlay">
        <div class="password-box">
            <h2>ğŸ”’ è¯·è¾“å…¥è®¿é—®å¯†ç </h2>
            <input type="password" id="passwordInput" placeholder="æ•°å­—å¯†ç " inputmode="numeric" pattern="\d*">
            <button id="submitPassword">è¿›å…¥</button>
            <p id="passwordError" class="error-message"></p>
        </div>
    </div>

    <!-- å€’è®¡æ—¶å¡ç‰‡ -->
    <div class="card" id="countdownCard">
        <h1 class="title">ğŸ ä¸™åˆæ–°æ˜¥ ğŸ</h1>
        <div class="sub-title">2026 Â· æ˜¥èŠ‚å€’è®¡æ—¶</div>
        <div class="gregorian-date"><span>ğŸ® 2æœˆ17æ—¥ æ˜ŸæœŸäºŒ ğŸ®</span></div>

        <div class="countdown-panel">
            <div class="time-block"><div class="time-number mono" id="days">00</div><div class="time-label">å¤©</div></div>
            <div class="time-block"><div class="time-number mono" id="hours">00</div><div class="time-label">æ—¶</div></div>
            <div class="time-block"><div class="time-number mono" id="minutes">00</div><div class="time-label">åˆ†</div></div>
            <div class="time-block"><div class="time-number mono" id="seconds">00</div><div class="time-label">ç§’</div></div>
        </div>

        <div class="greeting-box" id="greetingBox">
            <div class="greeting-text" id="mainGreeting">ğŸ§§ è·ç¦»æ˜¥èŠ‚è¿˜æœ‰</div>
            <div class="sub-greeting" id="subGreeting">è¿é©¬å¹´ Â· çº³ç¦è¿</div>
        </div>

        <div class="footer-note">
            <span>ğŸ“… å†œå†ä¸™åˆå¹´ æ­£æœˆåˆä¸€</span>
            <span>â±ï¸ åŒ—äº¬æ—¶é—´ / ä¸œå…«åŒº</span>
        </div>
    </div>

    <!-- çƒŸèŠ±è¦†ç›–å±‚ -->
    <div class="fireworks-overlay" id="fireworksOverlay">
        <canvas id="fireworksCanvas"></canvas>
        <!-- æ–‡æ¡ˆå®¹å™¨ (å°†åŠ¨æ€ç”Ÿæˆ message-item) -->
        <div class="new-year-text" id="newYearText"></div>
        <div class="sound-tip" id="soundTip">ğŸ”Š ç‚¹å‡»ç”»é¢ å¼€å¯éŸ³æ•ˆ</div>
    </div>

    <script>
        // ========== æ•°å­—å¯†ç éªŒè¯ ==========
        (function() {
            const CORRECT_PASSWORD = "41";  // å¯ä¿®æ”¹ä¸ºä»»æ„æ•°å­—å¯†ç 
            const overlay = document.getElementById('passwordOverlay');
            const passwordInput = document.getElementById('passwordInput');
            const submitBtn = document.getElementById('submitPassword');
            const errorEl = document.getElementById('passwordError');

            // æ£€æŸ¥æ˜¯å¦å·²é€šè¿‡éªŒè¯ï¼ˆä½¿ç”¨sessionStorageï¼Œå…³é—­æ ‡ç­¾é¡µåå¤±æ•ˆï¼‰
            if (sessionStorage.getItem('pageUnlocked') === 'true') {
                overlay.classList.add('hidden');
                return;  // å·²é€šè¿‡ï¼Œæ— éœ€ç»‘å®šäº‹ä»¶
            }

            // éªŒè¯å‡½æ•°
            function checkPassword() {
                const entered = passwordInput.value.trim();
                if (entered === CORRECT_PASSWORD) {
                    // å¯†ç æ­£ç¡®ï¼Œéšè—é®ç½©å¹¶è®°ä½çŠ¶æ€
                    overlay.classList.add('hidden');
                    sessionStorage.setItem('pageUnlocked', 'true');
                    errorEl.textContent = '';
                } else {
                    errorEl.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥';
                    passwordInput.value = '';
                    passwordInput.focus();
                }
            }

            // ç»‘å®šäº‹ä»¶
            submitBtn.addEventListener('click', checkPassword);
            passwordInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    checkPassword();
                }
            });

            // é™åˆ¶åªèƒ½è¾“å…¥æ•°å­—
            passwordInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
        })();
    </script>

    <script>
        // ========== åŸæœ‰å€’è®¡æ—¶å’ŒçƒŸèŠ±ä»£ç ï¼ˆå®Œå…¨ä¸å˜ï¼‰ ==========
        (function() {
            // ---------- æ‰‹åŠ¨é…ç½®åŒºåŸŸ ----------
            const newYearMessages = [
                "æ–°å¹´å¿«ä¹ï¼",
                "ä½ ä½œä¸ºysyçš„æœ‹å‹",
                "æ”¶åˆ°äº†ysyçš„ç¬¬ä¸€ä¸ªæ–°å¹´ç¥ç¦",
                "å¸Œæœ›",
                "æ¥ä¸‹æ¥ä¸€å¹´é‡Œ",
                "æˆ‘ä»¬ä¾ç„¶æ˜¯æœ‹å‹ï¼"
            ];
            const messageSwitchInterval = 3000;
            const lastMessageImageUrl = "https://ts3.tc.mm.bing.net/th/id/OIP-C.yV59KAD3qTWiRrzrp-1E5gHaEt?rs=1&pid=ImgDetMain&o=7&rm=3";
            const TARGET_DATE = new Date("2026-02-17T00:00:00+08:00");
            // ---------- é…ç½®ç»“æŸ ----------

            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');
            const mainGreeting = document.getElementById('mainGreeting');
            const subGreeting = document.getElementById('subGreeting');
            const countdownCard = document.getElementById('countdownCard');
            const overlay = document.getElementById('fireworksOverlay');
            const newYearContainer = document.getElementById('newYearText');
            const soundTip = document.getElementById('soundTip');

            let timer = null;
            let fireworksTriggered = false;
            let carouselStarted = false;
            let carouselTimer = null;
            let textTimer = null;

            function pad(num) {
                return String(num).padStart(2, '0');
            }

            function updateCountdown() {
                const now = new Date();
                const diffMs = TARGET_DATE - now;

                if (diffMs <= 0) {
                    if (timer) {
                        clearInterval(timer);
                        timer = null;
                    }
                    daysEl.textContent = '00';
                    hoursEl.textContent = '00';
                    minutesEl.textContent = '00';
                    secondsEl.textContent = '00';
                    mainGreeting.textContent = 'ğŸ‰ ä¸™åˆé©¬å¹´ Â· æ–°æ˜¥å¿«ä¹ ğŸ‰';
                    subGreeting.textContent = 'ä¸‡äº‹é¡ºé‚ Â· å¹³å®‰å–œä¹';
                    
                    if (!fireworksTriggered) {
                        fireworksTriggered = true;
                        startFireworksTransition();
                    }
                    return false;
                }

                const totalSeconds = Math.floor(diffMs / 1000);
                const days = Math.floor(totalSeconds / 86400);
                const remaining = totalSeconds % 86400;
                const hours = Math.floor(remaining / 3600);
                const minutes = Math.floor((remaining % 3600) / 60);
                const seconds = remaining % 60;

                daysEl.textContent = pad(days);
                hoursEl.textContent = pad(hours);
                minutesEl.textContent = pad(minutes);
                secondsEl.textContent = pad(seconds);
                mainGreeting.textContent = 'ğŸ§§ è·ç¦»æ˜¥èŠ‚è¿˜æœ‰';
                subGreeting.textContent = 'è¿é©¬å¹´ Â· çº³ç¦è¿';
                return true;
            }

            function startMessageCarousel() {
                if (carouselStarted) return;
                carouselStarted = true;
                newYearContainer.innerHTML = '';

                const messages = (Array.isArray(newYearMessages) && newYearMessages.length > 0) 
                                 ? newYearMessages 
                                 : ['æ–°å¹´å¿«ä¹'];
                const interval = (typeof messageSwitchInterval === 'number' && messageSwitchInterval >= 200) 
                                 ? messageSwitchInterval 
                                 : 3000;

                messages.forEach((msg, index) => {
                    const isLast = (index === messages.length - 1);
                    const item = document.createElement('div');
                    item.className = 'message-item' + (isLast ? ' last-item' : '');

                    if (isLast && lastMessageImageUrl) {
                        const textSpan = document.createElement('span');
                        textSpan.textContent = msg;
                        item.appendChild(textSpan);

                        const img = document.createElement('img');
                        img.src = lastMessageImageUrl;
                        img.alt = 'ğŸ†';
                        img.style.width = '2.4em';
                        img.style.height = '1.5em';
                        img.style.marginLeft = '0.3em';
                        item.appendChild(img);
                    } else {
                        item.textContent = msg;
                    }

                    newYearContainer.appendChild(item);
                });

                const items = document.querySelectorAll('.message-item');
                if (items.length === 0) return;

                let currentIndex = 0;
                items[currentIndex].classList.add('active');

                if (items.length === 1) return;

                carouselTimer = setInterval(() => {
                    items[currentIndex].classList.remove('active');
                    currentIndex++;
                    if (currentIndex < items.length) {
                        items[currentIndex].classList.add('active');
                    } else {
                        clearInterval(carouselTimer);
                        carouselTimer = null;
                    }
                }, interval);
            }

            // ---------- çƒŸèŠ±ç³»ç»Ÿ ----------
            let canvas = document.getElementById('fireworksCanvas');
            let ctx = canvas.getContext('2d');
            let animFrame = null;
            let particles = [];
            let risingFireworks = [];

            let audioCtx = null;
            let audioUnlocked = false;
            let pendingExplosionSound = false;

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);

            function initAudio() {
                if (audioUnlocked) return true;
                try {
                    if (!audioCtx) {
                        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    if (audioCtx.state === 'suspended') {
                        audioCtx.resume().then(() => {
                            audioUnlocked = true;
                            soundTip.classList.remove('show');
                            if (pendingExplosionSound) {
                                playExplosionSound();
                                pendingExplosionSound = false;
                            }
                        }).catch(e => console.warn('éŸ³é¢‘è§£é”å¤±è´¥', e));
                    } else {
                        audioUnlocked = true;
                        soundTip.classList.remove('show');
                    }
                } catch (e) {
                    console.warn('Web Audio API ä¸æ”¯æŒ', e);
                }
                return audioUnlocked;
            }

            function playExplosionSound() {
                if (!audioCtx || audioCtx.state !== 'running') {
                    pendingExplosionSound = true;
                    if (!audioUnlocked) soundTip.classList.add('show');
                    return;
                }
                try {
                    const duration = 0.4;
                    const sampleRate = audioCtx.sampleRate;
                    const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
                    const channel = buffer.getChannelData(0);
                    for (let i = 0; i < buffer.length; i++) {
                        channel[i] = Math.random() * 2 - 1;
                    }
                    const gainNode = audioCtx.createGain();
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
                    
                    const source = audioCtx.createBufferSource();
                    source.buffer = buffer;
                    source.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    source.start();
                } catch (e) {
                    console.warn('æ’­æ”¾çˆ†ç‚¸å£°å¤±è´¥', e);
                }
            }

            function createExplosion(centerX, centerY) {
                const count = 80;
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 5;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed - 1.5;
                    const color = `hsl(${Math.random() * 60 + 20}, 100%, 65%)`;
                    particles.push({
                        x: centerX, y: centerY, vx, vy,
                        size: 4 + Math.random() * 6,
                        alpha: 1.0, color, life: 1.0,
                        decay: 0.01 + Math.random() * 0.02
                    });
                }
                playExplosionSound();

                if (!carouselStarted) {
                    if (textTimer) clearTimeout(textTimer);
                    textTimer = setTimeout(() => {
                        startMessageCarousel();
                    }, 800);
                }
            }

            function launchFirework() {
                const startX = 100 + Math.random() * (canvas.width - 200);
                const startY = canvas.height - 30;
                const targetY = canvas.height * 0.2 + Math.random() * canvas.height * 0.4;
                risingFireworks.push({
                    x: startX, y: startY,
                    vy: -6 - Math.random() * 4,
                    targetY, exploded: false
                });
            }

            function updateFireworks() {
                if (!ctx) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                for (let i = risingFireworks.length - 1; i >= 0; i--) {
                    const f = risingFireworks[i];
                    if (f.exploded) {
                        risingFireworks.splice(i, 1);
                        continue;
                    }
                    f.y += f.vy;
                    if (f.y <= f.targetY || f.y < 50) {
                        createExplosion(f.x, f.y);
                        f.exploded = true;
                    } else {
                        ctx.beginPath();
                        ctx.arc(f.x, f.y, 8, 0, Math.PI * 2);
                        ctx.fillStyle = '#FFE55C';
                        ctx.shadowColor = '#FFA500';
                        ctx.shadowBlur = 15;
                        ctx.fill();
                    }
                }

                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1;
                    p.alpha -= p.decay;
                    p.life -= p.decay;

                    if (p.alpha <= 0.02 || p.y > canvas.height + 50) {
                        particles.splice(i, 1);
                        continue;
                    }

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.shadowColor = '#FFB347';
                    ctx.shadowBlur = 10;
                    ctx.fill();
                }

                ctx.globalAlpha = 1.0;
                ctx.shadowBlur = 0;
                animFrame = requestAnimationFrame(updateFireworks);
            }

            function startFireworksTransition() {
                countdownCard.classList.add('fade-out');
                overlay.classList.add('show');
                resizeCanvas();
                if (animFrame) cancelAnimationFrame(animFrame);
                animFrame = requestAnimationFrame(updateFireworks);

                setTimeout(() => {
                    launchFirework();
                }, 400);

                if (!audioUnlocked) {
                    soundTip.classList.add('show');
                }

                canvas.addEventListener('click', function canvasClickHandler() {
                    if (!audioUnlocked) {
                        initAudio();
                    }
                    launchFirework();
                });
            }

            const stillActive = updateCountdown();
            if (stillActive) {
                if (timer) clearInterval(timer);
                timer = setInterval(updateCountdown, 1000);
            }

            if (new Date() >= TARGET_DATE && !fireworksTriggered) {
                fireworksTriggered = true;
                startFireworksTransition();
            }

            window.addEventListener('beforeunload', function() {
                if (timer) clearInterval(timer);
                if (animFrame) cancelAnimationFrame(animFrame);
                if (carouselTimer) clearInterval(carouselTimer);
                if (textTimer) clearTimeout(textTimer);
            });
        })();
    </script>
</body>
</html>
