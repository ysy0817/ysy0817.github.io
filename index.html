<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>ğŸ 2026æ˜¥èŠ‚ Â· çƒŸèŠ±è¿æ–°å¹´ ğŸ†</title>
    <style>
        /* ----- åŸæœ‰å€’è®¡æ—¶æ ·å¼ (ç¨ä½œè°ƒæ•´ï¼Œæ·»åŠ æ·¡å‡ºè¿‡æ¸¡) ----- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }

        body {
            min-height: 100vh;
            background: radial-gradient(circle at 30% 20%, #ac2f2f, #6f1111);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M20 20 Q30 10 40 20 T60 20 T80 20" stroke="%23ffcc66" fill="none" stroke-width="1.5"/><circle cx="70" cy="70" r="3" fill="%23ffaa33"/><circle cx="15" cy="85" r="4" fill="%23ffaa33"/><circle cx="88" cy="18" r="2" fill="%23ffaa33"/></svg>');
            background-repeat: repeat;
            pointer-events: none;
            z-index: 0;
        }

        /* ä¸»å¡ç‰‡ â€”â€” å€’è®¡æ—¶å¡ç‰‡ï¼Œæ·»åŠ æ·¡å‡ºè¿‡æ¸¡ */
        .card {
            position: relative;
            z-index: 10;
            max-width: 780px;
            width: 100%;
            background: #fffef7;
            background-image: linear-gradient(145deg, #fffdf0 0%, #fff5e6 100%);
            border-radius: 48px 48px 48px 48px;
            box-shadow: 0 30px 50px rgba(80, 0, 0, 0.6), 0 0 0 2px #e4bf7e inset, 0 0 0 5px #b54708 inset;
            padding: 2.5rem 2rem;
            text-align: center;
            transition: opacity 1.2s ease-in-out;
            border: 6px solid #cf7f3a;
            opacity: 1;
        }

        .card.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .card::after {
            content: 'ğŸ‰ ç¦ ğŸ‰';
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-size: 2.2rem;
            opacity: 0.1;
            color: #b33e3e;
            transform: rotate(-5deg);
            pointer-events: none;
        }

        .title {
            color: #972020;
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            letter-spacing: 6px;
            text-shadow: 2px 2px 0 #f9d77e, 4px 4px 0 rgba(180, 60, 20, 0.3);
            margin-bottom: 6px;
        }

        .sub-title {
            font-size: clamp(1.2rem, 4vw, 1.8rem);
            color: #b14b2c;
            background: linear-gradient(90deg, #f0cf96, #f7e2b5);
            display: inline-block;
            padding: 0.4rem 2rem;
            border-radius: 60px;
            margin: 10px 0 8px;
            font-weight: 600;
            box-shadow: 0 4px 8px #b2582e33;
            border: 1px solid #ffd57a;
        }

        .gregorian-date {
            font-size: 1.3rem;
            color: #773d1c;
            background: #fceedb;
            padding: 0.3rem 1.8rem;
            border-radius: 40px;
            display: inline-block;
            margin: 10px 0 20px;
            border: 1px dashed #c75e2b;
            font-weight: 500;
        }

        .countdown-panel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px 25px;
            margin: 35px 0 25px;
        }

        .time-block {
            background: #9f2d2d;
            background: linear-gradient(145deg, #b33b3b, #831e1e);
            border-radius: 32px;
            padding: 20px 12px 16px;
            min-width: 120px;
            flex: 1 1 0;
            box-shadow: 0 12px 0 #521212, 0 8px 15px #3d0f0f;
            border: 2px solid #fec169;
            transition: transform 0.1s ease;
        }

        .time-number {
            font-size: clamp(3.2rem, 8vw, 4.8rem);
            font-weight: 900;
            color: #ffdfa7;
            text-shadow: 0 3px 0 #aa4c1e, 0 6px 0 #542a0f;
            line-height: 1;
            margin-bottom: 6px;
            font-feature-settings: "tnum";
            letter-spacing: 4px;
        }

        .time-label {
            font-size: 1.3rem;
            color: #ffefc0;
            background: #ac3f2a;
            display: inline-block;
            padding: 5px 18px;
            border-radius: 40px;
            font-weight: 600;
            border: 1px solid #fcc56e;
            box-shadow: inset 0 -2px 0 #64200e;
        }

        .greeting-box {
            background: #ea9e48;
            background: linear-gradient(135deg, #f6b44a, #e8872b);
            border-radius: 50px;
            padding: 18px 18px;
            margin: 30px 0 10px;
            border: 3px solid #fde7b4;
            box-shadow: 0 6px 0 #a14415;
        }

        .greeting-text {
            font-size: 1.9rem;
            font-weight: 700;
            color: #2f0f00;
            text-shadow: 1px 1px 0 #ffcb7a;
            letter-spacing: 3px;
        }

        .sub-greeting {
            font-size: 1.2rem;
            color: #582b0b;
            margin-top: 6px;
        }

        .footer-note {
            margin-top: 30px;
            color: #b1572c;
            font-size: 1rem;
            border-top: 2px dotted #e5a45b;
            padding-top: 18px;
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .footer-note span {
            background: #ffefd2;
            padding: 6px 14px;
            border-radius: 30px;
            font-weight: 500;
            border: 1px solid #d48b47;
        }

        /* ----- çƒŸèŠ±å…¨å±è¦†ç›–å±‚ (é»‘è‰²èƒŒæ™¯ï¼Œå¹³æ»‘è¿‡æ¸¡) ----- */
        .fireworks-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 100;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            pointer-events: none;           /* åˆå§‹æ— æ³•ç‚¹å‡»ï¼Œæ·¡å…¥åå…è®¸ç‚¹å‡»ç”»å¸ƒ */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fireworks-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        #fireworksCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        .new-year-text {
            position: relative;
            z-index: 200;
            color: #FFD966;
            font-size: clamp(3rem, 15vw, 8rem);
            font-weight: 900;
            text-shadow: 0 0 20px #ffaa33, 0 0 40px #ff5500;
            font-family: 'KaiTi', 'æ¥·ä½“', 'åæ–‡æ¥·ä½“', serif;
            letter-spacing: 12px;
            transform: scale(0.9);
            animation: glowPulse 2s infinite alternate;
            opacity: 0;
            transition: opacity 1s ease;
            pointer-events: none;    /* è®©ç‚¹å‡»ç©¿é€åˆ°canvasï¼Œç”¨äºè§£é”å£°éŸ³ */
        }

        .new-year-text.show {
            opacity: 1;
        }

        @keyframes glowPulse {
            from { text-shadow: 0 0 20px #ff9900, 0 0 40px #ff3300; }
            to { text-shadow: 0 0 30px #ffcc66, 0 0 70px #ff6633; }
        }

        /* æç¤ºç”¨æˆ·ç‚¹å‡»è§£é”å£°éŸ³ (åªåœ¨æœªè§£é”æ—¶æ˜¾ç¤º) */
        .sound-tip {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            color: rgba(255,255,200,0.8);
            background: rgba(0,0,0,0.6);
            padding: 8px 20px;
            border-radius: 40px;
            font-size: 1.2rem;
            border: 1px solid #ffb347;
            backdrop-filter: blur(4px);
            pointer-events: none;
            transition: opacity 0.5s;
            opacity: 0;
        }

        .sound-tip.show {
            opacity: 1;
        }

        .mono {
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <!-- å€’è®¡æ—¶å¡ç‰‡ -->
    <div class="card" id="countdownCard">
        <h1 class="title">ğŸ ä¸™åˆæ–°æ˜¥ ğŸ</h1>
        <div class="sub-title">2026 Â· æ˜¥èŠ‚å€’è®¡æ—¶</div>
        <div class="gregorian-date"><span>ğŸ® 2æœˆ17æ—¥ æ˜ŸæœŸäºŒ ğŸ®</span></div>

        <div class="countdown-panel">
            <div class="time-block"><div class="time-number mono" id="days">00</div><div class="time-label">å¤©</div></div>
            <div class="time-block"><div class="time-number mono" id="hours">00</div><div class="time-label">æ—¶</div></div>
            <div class="time-block"><div class="time-number mono" id="minutes">00</div><div class="time-label">åˆ†</div></div>
            <div class="time-block"><div class="time-number mono" id="seconds">00</div><div class="time-label">ç§’</div></div>
        </div>

        <div class="greeting-box" id="greetingBox">
            <div class="greeting-text" id="mainGreeting">ğŸ§§ è·ç¦»æ˜¥èŠ‚è¿˜æœ‰</div>
            <div class="sub-greeting" id="subGreeting">è¿é©¬å¹´ Â· çº³ç¦è¿</div>
        </div>

        <div class="footer-note">
            <span>ğŸ“… å†œå†ä¸™åˆå¹´ æ­£æœˆåˆä¸€</span>
            <span>â±ï¸ åŒ—äº¬æ—¶é—´ / ä¸œå…«åŒº</span>
        </div>
    </div>

    <!-- çƒŸèŠ±è¦†ç›–å±‚ (é»‘è‰²èƒŒæ™¯ + canvas + æ–°å¹´å¿«ä¹æ–‡å­— + å£°éŸ³æç¤º) -->
    <div class="fireworks-overlay" id="fireworksOverlay">
        <canvas id="fireworksCanvas"></canvas>
        <div class="new-year-text" id="newYearText">æ–°å¹´å¿«ä¹</div>
        <div class="sound-tip" id="soundTip">ğŸ”Š ç‚¹å‡»ç”»é¢ å¼€å¯éŸ³æ•ˆ</div>
    </div>

    <script>
        (function() {
            // ---------- åŸæœ‰å€’è®¡æ—¶é€»è¾‘ (æ”¹é€ ï¼šç»“æŸæ—¶è§¦å‘çƒŸèŠ±) ----------
            const TARGET_DATE = new Date(); // å…ˆè·å–å½“å‰æ—¶é—´
            TARGET_DATE.setSeconds(TARGET_DATE.getSeconds() + 5); // åŠ 5ç§’
            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');
            const mainGreeting = document.getElementById('mainGreeting');
            const subGreeting = document.getElementById('subGreeting');
            const greetingBox = document.getElementById('greetingBox');
            const countdownCard = document.getElementById('countdownCard');
            const overlay = document.getElementById('fireworksOverlay');
            const newYearText = document.getElementById('newYearText');
            const soundTip = document.getElementById('soundTip');

            let timer = null;
            let fireworksTriggered = false;   // é˜²æ­¢é‡å¤è§¦å‘çƒŸèŠ±

            function pad(num) {
                return String(num).padStart(2, '0');
            }

            // å€’è®¡æ—¶æ›´æ–°å‡½æ•° (ä¸åŸé€»è¾‘ä¸€è‡´ï¼Œä½†æ£€æµ‹åˆ°æ—¶é—´â‰¤0æ—¶è§¦å‘çƒŸèŠ±)
            function updateCountdown() {
                const now = new Date();
                const diffMs = TARGET_DATE - now;

                if (diffMs <= 0) {
                    // æ—¶é—´å·²åˆ°ï¼Œåœæ­¢å®šæ—¶å™¨ï¼Œè§¦å‘çƒŸèŠ±ï¼ˆä»…ä¸€æ¬¡ï¼‰
                    if (timer) {
                        clearInterval(timer);
                        timer = null;
                    }
                    // å¯ä»¥å…ˆæŠŠæ•°å­—ç½®é›¶ï¼Œä½†å¡ç‰‡é©¬ä¸Šè¦æ·¡å‡ºï¼Œå¯è§†ä½œå¯é€‰
                    daysEl.textContent = '00';
                    hoursEl.textContent = '00';
                    minutesEl.textContent = '00';
                    secondsEl.textContent = '00';
                    mainGreeting.textContent = 'ğŸ‰ ä¸™åˆé©¬å¹´ Â· æ–°æ˜¥å¿«ä¹ ğŸ‰';
                    subGreeting.textContent = 'ä¸‡äº‹é¡ºé‚ Â· å¹³å®‰å–œä¹';
                    
                    // è§¦å‘çƒŸèŠ±è¿‡æ¸¡ (å¦‚æœè¿˜æœªè§¦å‘)
                    if (!fireworksTriggered) {
                        fireworksTriggered = true;
                        startFireworksTransition();
                    }
                    return false;
                }

                // æ­£å¸¸å€’è®¡æ—¶è®¡ç®—
                const totalSeconds = Math.floor(diffMs / 1000);
                const days = Math.floor(totalSeconds / 86400);
                const remaining = totalSeconds % 86400;
                const hours = Math.floor(remaining / 3600);
                const minutes = Math.floor((remaining % 3600) / 60);
                const seconds = remaining % 60;

                daysEl.textContent = pad(days);
                hoursEl.textContent = pad(hours);
                minutesEl.textContent = pad(minutes);
                secondsEl.textContent = pad(seconds);

                mainGreeting.textContent = 'ğŸ§§ è·ç¦»æ˜¥èŠ‚è¿˜æœ‰';
                subGreeting.textContent = 'è¿é©¬å¹´ Â· çº³ç¦è¿';
                return true;
            }

            // ---------- çƒŸèŠ± & å£°éŸ³ç³»ç»Ÿ ----------
            let canvas = document.getElementById('fireworksCanvas');
            let ctx = canvas.getContext('2d');
            let animFrame = null;
            let particles = [];
            let rising = null;                // ä¸Šå‡çš„çƒŸèŠ± {x, y, vy, targetY, exploded}
            let explosionOccurred = false;     // æ ‡è®°æ˜¯å¦å·²çˆ†ç‚¸(ç”¨äºæ˜¾ç¤ºæ–‡å­—)
            let textTimer = null;               // å»¶è¿Ÿæ˜¾ç¤ºæ–°å¹´å¿«ä¹çš„å®šæ—¶å™¨

            // éŸ³é¢‘ç›¸å…³ (ä½¿ç”¨Web Audio APIï¼Œéœ€ç”¨æˆ·æ‰‹åŠ¿è§£é”)
            let audioCtx = null;
            let audioUnlocked = false;          // æ˜¯å¦å·²è§£é”ï¼ˆç”¨æˆ·ç‚¹å‡»è¿‡ç”»å¸ƒï¼‰
            let pendingExplosionSound = false;   // å¦‚æœæœ‰çˆ†ç‚¸éœ€è¦æ’­æ”¾ä½†æœªè§£é”ï¼Œå¯æš‚å­˜

            // åˆå§‹åŒ–ç”»å¸ƒå¤§å°
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            window.addEventListener('resize', resizeCanvas);

            // è§£é”éŸ³é¢‘ï¼šåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»ç”»å¸ƒæ—¶è°ƒç”¨
            function initAudio() {
                if (audioUnlocked) return true;
                try {
                    // åˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå®ƒä¸€å¼€å§‹æ˜¯suspended
                    if (!audioCtx) {
                        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                    // å”¤é†’ä¸Šä¸‹æ–‡
                    if (audioCtx.state === 'suspended') {
                        audioCtx.resume().then(() => {
                            audioUnlocked = true;
                            soundTip.classList.remove('show'); // éšè—æç¤º
                            // å¦‚æœä¹‹å‰æœ‰å¾…æ’­æ”¾çš„çˆ†ç‚¸ï¼Œç«‹å³æ’­æ”¾ä¸€æ¬¡
                            if (pendingExplosionSound) {
                                playExplosionSound();
                                pendingExplosionSound = false;
                            }
                        }).catch(e => console.warn('éŸ³é¢‘è§£é”å¤±è´¥', e));
                    } else {
                        audioUnlocked = true;
                        soundTip.classList.remove('show');
                    }
                } catch (e) {
                    console.warn('Web Audio API ä¸æ”¯æŒ', e);
                    audioUnlocked = false; // ä¸æ”¯æŒå°±ä¸å¼ºæ±‚äº†
                }
                return audioUnlocked;
            }

            // æ’­æ”¾çˆ†ç‚¸å£° (çŸ­ä¿ƒçš„ç™½å™ªå£°è¡°å‡)
            function playExplosionSound() {
                if (!audioCtx || audioCtx.state !== 'running') {
                    // æœªè§£é”ï¼Œæ ‡è®°å¾…æ’­æ”¾å¹¶æ˜¾ç¤ºæç¤º
                    pendingExplosionSound = true;
                    if (!audioUnlocked) soundTip.classList.add('show');
                    return;
                }

                try {
                    const duration = 0.4; // ç§’
                    const sampleRate = audioCtx.sampleRate;
                    const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
                    const channel = buffer.getChannelData(0);
                    for (let i = 0; i < buffer.length; i++) {
                        // ç™½å™ªå£°
                        channel[i] = Math.random() * 2 - 1;
                    }
                    // åˆ›å»ºè¡°å‡åŒ…ç»œ
                    const gainNode = audioCtx.createGain();
                    gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
                    
                    const source = audioCtx.createBufferSource();
                    source.buffer = buffer;
                    source.connect(gainNode);
                    gainNode.connect(audioCtx.destination);
                    source.start();
                } catch (e) {
                    console.warn('æ’­æ”¾çˆ†ç‚¸å£°å¤±è´¥', e);
                }
            }

            // åˆ›å»ºçˆ†ç‚¸ç²’å­ (åœ¨æŒ‡å®šåæ ‡)
            function createExplosion(centerX, centerY) {
                const count = 80;
                for (let i = 0; i < count; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 2 + Math.random() * 5;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed - 1.5; // è½»å¾®ä¸Šå‡å€¾å‘
                    const color = `hsl(${Math.random() * 60 + 20}, 100%, 65%)`; // æš–è‰²
                    particles.push({
                        x: centerX,
                        y: centerY,
                        vx: vx,
                        vy: vy,
                        size: 4 + Math.random() * 6,
                        alpha: 1.0,
                        color: color,
                        life: 1.0,
                        decay: 0.01 + Math.random() * 0.02
                    });
                }
                // æ ‡è®°å·²çˆ†ç‚¸ï¼Œå¹¶å¯åŠ¨å®šæ—¶å™¨æ˜¾ç¤ºæ–°å¹´å¿«ä¹ (å»¶è¿Ÿ0.8ç§’ï¼Œç­‰ç²’å­ç»½æ”¾)
                if (!explosionOccurred) {
                    explosionOccurred = true;
                    if (textTimer) clearTimeout(textTimer);
                    textTimer = setTimeout(() => {
                        newYearText.classList.add('show');
                    }, 800);
                }
                // åŒæ—¶æ’­æ”¾çˆ†ç‚¸å£°
                playExplosionSound();
            }

            // é‡ç½®çƒŸèŠ±çŠ¶æ€ (å‡†å¤‡æ–°çš„ä¸€å‘)
            function launchFirework() {
                // éšè—æ–‡å­—
                newYearText.classList.remove('show');
                // æ¸…ç©ºç°æœ‰ç²’å­
                particles = [];
                // éšæœºèµ·å§‹x
                const startX = 100 + Math.random() * (canvas.width - 200);
                const startY = canvas.height - 30;
                const targetY = canvas.height * 0.3 + Math.random() * canvas.height * 0.2;
                rising = {
                    x: startX,
                    y: startY,
                    vy: -6 - Math.random() * 3,   // ä¸Šå‡é€Ÿåº¦
                    targetY: targetY,
                    exploded: false
                };
                explosionOccurred = false; // æ–°çƒŸèŠ±æœªçˆ†ç‚¸
                if (textTimer) clearTimeout(textTimer);
            }

            // åŠ¨ç”»æ›´æ–°
            function updateFireworks() {
                if (!ctx) return;

                // æ¸…ç©ºç”»å¸ƒ (é»‘è‰²èƒŒæ™¯)
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // å¤„ç†ä¸Šå‡çƒŸèŠ±
                if (rising && !rising.exploded) {
                    // ç§»åŠ¨
                    rising.y += rising.vy;
                    // è½»å¾®ç©ºæ°”é˜»åŠ›æˆ–ä¸å˜
                    if (rising.y <= rising.targetY) {
                        // åˆ°è¾¾ç›®æ ‡ï¼Œçˆ†ç‚¸
                        createExplosion(rising.x, rising.y);
                        rising.exploded = true;
                        rising = null;
                    } else {
                        // ç»˜åˆ¶ä¸Šå‡å¼¹å¤´ (ç™½è‰²/é‡‘è‰²äº®ç‚¹)
                        ctx.beginPath();
                        ctx.arc(rising.x, rising.y, 8, 0, Math.PI * 2);
                        ctx.fillStyle = '#FFE55C';
                        ctx.shadowColor = '#FFA500';
                        ctx.shadowBlur = 15;
                        ctx.fill();
                        ctx.shadowBlur = 0; // é‡ç½®é˜´å½±é¿å…å½±å“ç²’å­
                    }
                }

                // æ›´æ–°å¹¶ç»˜åˆ¶ç²’å­
                for (let i = particles.length - 1; i >= 0; i--) {
                    const p = particles[i];
                    // ç‰©ç†æ›´æ–°
                    p.x += p.vx;
                    p.y += p.vy;
                    p.vy += 0.1; // é‡åŠ›
                    p.alpha -= p.decay;
                    p.life -= p.decay;

                    if (p.alpha <= 0.02 || p.y > canvas.height + 50) {
                        particles.splice(i, 1);
                        continue;
                    }

                    // ç»˜åˆ¶ç²’å­
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                    ctx.fillStyle = p.color;
                    ctx.globalAlpha = p.alpha;
                    ctx.shadowColor = '#FFB347';
                    ctx.shadowBlur = 10;
                    ctx.fill();
                }

                // é‡ç½®é€æ˜åº¦ã€é˜´å½±
                ctx.globalAlpha = 1.0;
                ctx.shadowBlur = 0;

                // å¦‚æœçƒŸèŠ±å·²çˆ†ç‚¸ä¸”ç²’å­æå°‘ï¼Œå¯å†è‡ªåŠ¨å‘å°„æ–°çƒŸèŠ±ï¼Ÿ(å¯é€‰) ä¸ºäº†æ•ˆæœï¼Œå¯å†è¡¥ä¸€å‘ï¼Œä½†éœ€æ±‚åªéœ€â€œå‡èµ·å¹¶ç‚¸å¼€â€ï¼Œç„¶åæ˜¾ç¤ºæ–‡å­—ã€‚æˆ‘ä»¬ä¿æŒç®€å•ï¼Œå¦‚æœç²’å­å¾ˆå°‘ä¸”risingä¸ºç©ºï¼Œå¯å»¶è¿Ÿå†å°„ä¸€å‘(å¢æ·»æ°”æ°›)
                if (!rising && particles.length === 0 && explosionOccurred) {
                    // å¯ä»¥é‡æ–°å‘å°„ï¼Œä½†æ–‡å­—å·²ç»æ˜¾ç¤ºï¼Œå¯ä¿ç•™ã€‚ä¹Ÿå¯ä»¥ä¸å†å‘å°„ï¼Œä¿æŒé™è°§ã€‚
                    // ä½†ä¸ºäº†è®©ç”¨æˆ·ç‚¹å‡»æ—¶æœ‰åé¦ˆï¼Œæˆ‘ä»¬åœ¨ç‚¹å‡»æ—¶å‘å°„æ–°çƒŸèŠ±ã€‚ä¸‹é¢å¤„ç†canvasç‚¹å‡»äº‹ä»¶ã€‚
                }

                animFrame = requestAnimationFrame(updateFireworks);
            }

            // å¯åŠ¨çƒŸèŠ±è¿‡æ¸¡
            function startFireworksTransition() {
                // 1. å¡ç‰‡æ·¡å‡º
                countdownCard.classList.add('fade-out');
                // 2. æ˜¾ç¤ºé»‘è‰²è¦†ç›–å±‚
                overlay.classList.add('show');
                // 3. è°ƒæ•´ç”»å¸ƒå°ºå¯¸å¹¶å¼€å§‹åŠ¨ç”»
                resizeCanvas();
                if (animFrame) cancelAnimationFrame(animFrame);
                animFrame = requestAnimationFrame(updateFireworks);
                
                // 4. å»¶è¿Ÿä¸€å°ä¸‹ä¸‹ï¼Œå‘å°„ç¬¬ä¸€æšçƒŸèŠ± (ç­‰é»‘è‰²å®Œå…¨æ˜¾ç°)
                setTimeout(() => {
                    launchFirework();
                }, 400);

                // 5. å£°éŸ³æç¤ºæ˜¾ç¤º (åˆå§‹æ˜¾ç¤ºï¼ŒéŸ³é¢‘è§£é”åæ¶ˆå¤±)
                if (!audioUnlocked) {
                    soundTip.classList.add('show');
                }

                // 6. ç»‘å®šç”»å¸ƒç‚¹å‡»äº‹ä»¶ï¼Œç”¨äºè§£é”éŸ³é¢‘ & å‘å°„æ–°çƒŸèŠ±
                canvas.addEventListener('click', function canvasClickHandler() {
                    // è§£é”éŸ³é¢‘ (å¦‚æœè¿˜æœªè§£é”)
                    if (!audioUnlocked) {
                        initAudio();  // å†…éƒ¨ä¼šresumeå¹¶éšè—æç¤º
                    } else {
                        // å·²è§£é”ï¼Œæ¯æ¬¡ç‚¹å‡»å¯ä»¥ç‡ƒæ”¾ä¸€ä¸ªæ–°çƒŸèŠ±ï¼Œå¹¶æ’­æ”¾çˆ†ç‚¸å£° (éšè—æ—§æ–‡å­—ï¼Œå‘å°„)
                        launchFirework();
                        playExplosionSound();  // ç«‹å³æ’­æ”¾çˆ†ç‚¸ (ä½†launchFireworké‡Œçˆ†ç‚¸æ—¶æ‰æ’­æ”¾, è¿™é‡Œéœ€è¦ç­‰çˆ†ç‚¸æ—¶è‡ªç„¶æ’­æ”¾)
                        // ä½†launchFireworké‡Œçˆ†ç‚¸ä¼šè°ƒç”¨playExplosionSoundï¼Œæ‰€ä»¥ä¸ç”¨é¢å¤–è°ƒç”¨
                        // ä½†ä¸ºäº†è®©ç‚¹å‡»å°±å“ï¼Œä¹Ÿå¯ä»¥ç«‹åˆ»æ’­æ”¾ä¸€ä¸ªå°çš„ï¼Ÿå°±æŒ‰çˆ†ç‚¸é€»è¾‘å§ã€‚
                    }
                });

                // 7. å¯é€‰ï¼šä¸ºäº†é˜²æ­¢canvasé®ç½©å¡ç‚¹å‡»ï¼Œæç¤ºå¯ç‚¹å‡»
            }

            // ---------- å¯åŠ¨å€’è®¡æ—¶ ----------
            const stillActive = updateCountdown();
            if (stillActive) {
                if (timer) clearInterval(timer);
                timer = setInterval(updateCountdown, 1000);
            }

            window.addEventListener('beforeunload', function() {
                if (timer) clearInterval(timer);
                if (animFrame) cancelAnimationFrame(animFrame);
            });

            // é¢å¤–å¤„ç†ï¼šå¦‚æœåŠ è½½æ—¶å°±å·²ç»è¿‡æœŸï¼ˆæ¯”å¦‚æµ‹è¯•ç”¨ï¼‰ï¼Œè§¦å‘çƒŸèŠ±
            if (new Date() >= TARGET_DATE && !fireworksTriggered) {
                fireworksTriggered = true;
                startFireworksTransition();
            }
        })();
    </script>
</body>
</html>
